---
layout: post
title: openaiæ•°æ®æå–çš„æ—¶å€™ä¸æ–­é‡å¤ç©ºå€¼çš„é—®é¢˜
date: 2024-12-05 19:03 +0800
excerpt: "åˆ©ç”¨openaiæå–ä¿¡æ¯åˆ°jsonçš„æ—¶å€™ä¼šé‡åˆ°openaiä¸åœåœ°é‡å¤æŸäº›ç©ºè®°å½•ï¼Œå¯¼è‡´é•¿åº¦è¶…è¿‡max token, jsonè¢«æˆªæ–­ã€‚"
---

# é—®é¢˜å’Œè§£å†³æ–¹æ³•
åœ¨æå–å†…å®¹å¹¶ä¸”è¦æ±‚openaiè¾“å‡ºä¸ºjsonæ ¼å¼çš„æ—¶å€™ï¼Œé‡åˆ°openaiä¸åœé‡å¤ç©ºè®°å½•çš„é—®é¢˜, å¾€jsonæ•°ç»„é‡Œé¢æ·»åŠ é‡å¤çš„æ²¡æœ‰æ„ä¹‰çš„è®°å½•, æœ€ç»ˆå¯¼è‡´è¾“å‡ºçš„tokenå¤ªå¤šï¼Œè¶…å‡ºäº†max tokensè®¾ç½®ï¼Œjsonå­—ç¬¦ä¸²è¢«æˆªæ–­ï¼Œå®¢æˆ·ç«¯æ²¡æ³•æ­£å¸¸è§£æjson.

ä¸æ–­é‡å¤æ²¡æœ‰æ„ä¹‰çš„è®°å½•ï¼š
~~~json
[{ "program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},
~~~

åƒæ˜¯promptè§¦å‘äº†Transfer decoderçš„æŸä¸ªæ­»å¾ªç¯. GPTæ˜¯ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦ç”Ÿæˆçš„ï¼Œæ¯ä¸ªæ—¶åˆ»ç”Ÿæˆçš„å†…å®¹ä¼šè¢«å¡«è¿›GPUé‡æ–°æ¨ç†ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œè¾“å…¥é‡å¤çš„å­—ä¸²ï¼Œè¾“å‡ºé‡å¤çš„å†…å®¹ï¼Œå¬èµ·æ¥å¾ˆç¬¦åˆè®¡ç®—æœºçš„é€»è¾‘ï¼Œè¿›å…¥æ­»å¾ªç¯ã€‚åƒæ˜¯è®¡ç®—æœºçš„æ€ç»´é’»å…¥äº†ç‰›è§’å°–ã€‚

å…·ä½“ç°è±¡å¯ä»¥çœ‹ä¸‹æ–‡ç« å°¾éƒ¨çš„æˆªå›¾å’Œæ—¥å¿—(æˆªå›¾å’Œæ—¥å¿—åˆ†å±ä¸¤ä¸ªä¸åŒçš„è¯·æ±‚ï¼Œé—®é¢˜æ˜¯ä¸€æ ·çš„):

## å‡ºé—®é¢˜çš„prompt:

~~~sh
{'content': '------\n\n- **Application Deadlines**\nRepresents the application deadlines for an undergraduate program, covering different types of deadlines such as early action, regular decision, and rolling admissions.\n  - **First-time Student Recommended FAFSA Filing Deadline**: For the 2025-26 academic year, it is recommended to file as soon as possible after the full application rollout.\n  - **Current Students Recommended FAFSA Filing Deadline**: April 15 for the 2025-26 academic year.\n  - **PA State Grant FAFSA Filing Deadline**: May 1 for the 2025-26 academic year.', 
'instruction': ('- Clearly specify all relevant deadlines, including early decision, regular decision, and rolling admission dates.\n- Ensure only deadlines for the specified program are included, excluding those for other programs.\n- Distinguish between concurrent/dual degrees and single degrees, ensuring the two are not confused',), 
'category': 'undergraduate program', 'category_tag': 'UNDERGRADUATE_PROGRAM', 'university': 'Pennsylvania State University', 'degree': 'COMMUNICATION ARTS AND SCIENCES B.A.'}
~~~

## è§£å†³åŠæ³•:
æŒ‡å®šè¦æ±‚openaiä¸è¦è¾“å‡ºç©ºçš„å†…å®¹ã€‚ æ³¨æ„æœ€åæ·»åŠ çš„ä¸€æ¡æŒ‡ä»¤ï¼Œè¿™æ¡æŒ‡ä»¤èƒ½å¼•å¯¼OpenAIé’»å‡ºç‰›è§’å°–ã€‚

~~~python
application_deadlines_extract_instruction = (
    "- Clearly specify all relevant deadlines, including early decision, regular decision, and rolling admission dates.\n"
    "- Ensure only deadlines for the specified program are included, excluding those for other programs.\n"
    "- Distinguish between concurrent/dual degrees and single degrees, ensuring the two are not confused"
    "- If the extracted date is empty, don't include it in the json array." # Add this line, to resolve openai infinite loop error, 
    ),
~~~

# å»¶ç”Ÿ
å…³äºæ•°æ®é‡å¤ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ªè®­ç»ƒæ•°æ®leakçš„æœ‰è¶£ç°è±¡, [ChatGPTç‹‚åè®­ç»ƒæ•°æ®ï¼Œè¿˜å¸¦ä¸ªäººä¿¡æ¯ï¼šDeepMindå‘ç°å¤§bugå¼•äº‰è®®](https://www.jiqizhixin.com/articles/2023-11-30-9), ç®—æ˜¯ä¸€ç§GPTæ”»å‡»æ–¹å¼ã€‚ç®€å•çš„ç†è§£å°±æ˜¯GPTä¸åœåœ°é‡å¤æŸäº›æ•°æ®çš„æ—¶å€™ä¼šåŒ¹é…åˆ°è®­ç»ƒæ•°æ®ä¸­çš„ä¸€æ®µæ–‡æœ¬ï¼Œç„¶åè¿™æ®µæ–‡æœ¬åŠåé¢çš„è®­ç»ƒæ•°æ®å°±ä¼šè¢«åŒ¹é…ä¸Šï¼Œç„¶ååŸå°ä¸åŠ¨çš„åå‡ºæ¥ã€‚

# é—®é¢˜æˆªå›¾ 
é—®é¢˜æˆªå›¾å¦‚ä¸‹:
![](/assets/img/openai/repeat_empty_json.png)

# æ—¥å¿—ï¼š

~~~sh
 File "/opt/anaconda3/envs/applyai-coredata/lib/python3.11/site-packages/llama_index/program/openai/base.py", line 67, in _parse_tool_calls
    output = output_cls.parse_raw(function_call.arguments)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "pydantic/main.py", line 548, in pydantic.main.BaseModel.parse_raw
pydantic.error_wrappers.ValidationError: 1 validation error for ApplicationDeadlines
__root__
  Unterminated string starting at: line 1 column 12402 (char 12401) (type=value_error.jsondecode; msg=Unterminated string starting at; doc={"deadlines":[{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program":"COMMUNICATION ARTS AND SCIENCES B.A.","category":"","admit_term":""},{"date":"","program; pos=12401; lineno=1; colno=12402)
2024-12-04 11:08:43,052 INFO - 0000..0000 [91mopenai_pydantic_program_proxy[0m.[1;34macall[0m:91: Error in acall with args: ()
kwargs:{'content': '------\n\n- **Application Deadlines**\nRepresents the application deadlines for an undergraduate program, covering different types of deadlines such as early action, regular decision, and rolling admissions.\n  - **First-time Student Recommended FAFSA Filing Deadline**: For the 2025-26 academic year, it is recommended to file as soon as possible after the full application rollout.\n  - **Current Students Recommended FAFSA Filing Deadline**: April 15 for the 2025-26 academic year.\n  - **PA State Grant FAFSA Filing Deadline**: May 1 for the 2025-26 academic year.', 'instruction': ('- Clearly specify all relevant deadlines, including early decision, regular decision, and rolling admission dates.\n- Ensure only deadlines for the specified program are included, excluding those for other programs.\n- Distinguish between concurrent/dual degrees and single degrees, ensuring the two are not confused',), 'category': 'undergraduate program', 'category_tag': 'UNDERGRADUATE_PROGRAM', 'university': 'Pennsylvania State University', 'degree': 'COMMUNICATION ARTS AND SCIENCES B.A.'}
~~~